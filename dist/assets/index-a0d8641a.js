import{J as i}from"./jump-9859fd9f.js";import{d as h,c as n,n as d}from"./index-8fffec42.js";import{C as u,E as p}from"./error-circle-filled-526edfc8.js";const _={components:{JumpIcon:i,SearchIcon:h},data(){const t=this.$createElement;return{data:[],originalData:[],size:"medium",tableLayout:!1,stripe:!0,bordered:!0,hover:!1,showHeader:!0,selectedRowKeys:[1],searchData:"",isSearchFocus:!1,renderSuffixIcon:()=>t(i),columns:[{colKey:"row-select",type:"multiple",width:50},{colKey:"id",title:"#",width:"50",ellipsis:!0},{colKey:"url",title:"URL",width:"150",cell:(a,{row:s})=>a("t-link",{attrs:{theme:"primary",hover:"color",href:"//"+s.url,target:"_blank"}},[s.url,a(i,{slot:"suffixIcon"})])},{colKey:"ip_address",title:"IP 地址",width:"150",ellipsis:!0},{colKey:"port_number",title:"端口号",width:"100"},{colKey:"service_name",title:"服务名称",width:"200",ellipsis:!0},{colKey:"protocol",title:"协议",width:"100"},{colKey:"state",title:"状态",width:"150",cell:(a,{row:s})=>{const r={open:{label:"开放",theme:"success",icon:a(u)},closed:{label:"关闭",theme:"danger",icon:a(p)}}[s.state.toLowerCase()]||{label:s.state,theme:"default"};return a("t-tag",{attrs:{shape:"round",theme:r.theme,variant:"light-outline"}},[r.icon,r.label])}},{colKey:"http_code",title:"HTTP状态码",width:"100",ellipsis:!0},{colKey:"http_title",title:"HTTP标题",width:"200",ellipsis:!0},{colKey:"https_code",title:"HTTPS状态码",width:"100",ellipsis:!0},{colKey:"https_title",title:"HTTP标题",width:"200",ellipsis:!0},{colKey:"operation",title:"操作",width:120,cell:(a,{row:s})=>a("t-button",{attrs:{theme:"danger",ghost:!0},on:{click:()=>this.deleteResult(s.id)}},["删除"])}],pagination:{current:1,pageSize:50,total:0,showJumper:!0}}},methods:{changeSearchFocus(t){this.isSearchFocus=t,t||this.filterData()},filterData(){this.searchData?this.data=this.originalData.filter(t=>Object.values(t).some(s=>s&&s.toString().toLowerCase().includes(this.searchData.toLowerCase()))):this.data=this.originalData},fetchResults(t){const a={task_id:t};this.$request.post("/api/port_scanner/task_status",JSON.stringify(a),{headers:{"Content-Type":"application/json"}}).then(s=>{const e=s.data.task_result.ports,r=e.length;r>0?(n.success(`端口扫描结果已获取，共${r}条数据。`),this.data=e,this.originalData=e,this.pagination.total=r):n.info("没有获取到端口扫描结果。")}).catch(s=>{console.log(s),n.error("获取失败")})},deleteResult(t){this.$request.delete(`/api/port_scanner/ports/${t}/delete`,{headers:{"Content-Type":"application/json"}}).then(()=>{n.success("结果删除成功"),this.data=this.data.filter(a=>a.id!==t),this.pagination.total=this.data.length}).catch(a=>{console.error(a),n.error("删除失败")})},rehandleSelectChange(t,{selectedRowData:a}){this.selectedRowKeys=t},startHTTPPathScan(){const t=this.selectedRowKeys.map(e=>this.data.find(r=>r.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`http://${e.ip_address}:${e.port_number}/FUZZ`),s={urls:[...new Set(t)],wordlist:"./wordlist/top7000.txt"};this.$request.post("/api/path_scanner/scan",s,{headers:{"Content-Type":"application/json"}}).then(()=>{n.success("路径扫描任务已启动")}).catch(e=>{console.error(e),n.error("启动路径扫描任务失败")})},startHTTPSPathScan(){const t=this.selectedRowKeys.map(e=>this.data.find(r=>r.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`https://${e.ip_address}:${e.port_number}/FUZZ`),s={urls:[...new Set(t)],wordlist:"./wordlist/top7000.txt"};this.$request.post("/api/path_scanner/scan",s,{headers:{"Content-Type":"application/json"}}).then(()=>{n.success("路径扫描任务已启动")}).catch(e=>{console.error(e),n.error("启动路径扫描任务失败")})},startHTTPPathSimpleScan(){const t=this.selectedRowKeys.map(e=>this.data.find(r=>r.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`http://${e.ip_address}:${e.port_number}/FUZZ`),s={urls:[...new Set(t)],delay:"0.5",wordlist:"./wordlist/default_wordlist.txt"};this.$request.post("/api/path_scanner/scan",s,{headers:{"Content-Type":"application/json"}}).then(()=>{n.success("路径扫描任务已启动")}).catch(e=>{console.error(e),n.error("启动路径扫描任务失败")})},startHTTPSPathSimpleScan(){const t=this.selectedRowKeys.map(e=>this.data.find(r=>r.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`https://${e.ip_address}:${e.port_number}/FUZZ`),s={urls:[...new Set(t)],delay:"0.5",wordlist:"./wordlist/default_wordlist.txt"};this.$request.post("/api/path_scanner/scan",s,{headers:{"Content-Type":"application/json"}}).then(()=>{n.success("路径扫描任务已启动")}).catch(e=>{console.error(e),n.error("启动路径扫描任务失败")})},onPageChange(t,a){this.pagination.defaultCurrent||(this.pagination.current=t.current,this.pagination.pageSize=t.pageSize)},exportToCSV(){const t=[],a=["ID","IP 地址","端口号","服务名称","协议","状态","是否支持HTTP","是否支持HTTPS"];t.push(a.join(",")),this.data.forEach(o=>{const l=[o.id,`"${o.ip_address}"`,o.port_number,`"${o.service_name}"`,o.protocol,o.state,o.is_http?"支持":"不支持",o.is_https?"支持":"不支持"];t.push(l.join(","))});const s=t.join(`
`),e=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download="port-scan-results.csv",r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},mounted(){const t=this.$route.query.task_id;this.fetchResults(t)}};var m=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("t-space",{attrs:{direction:"vertical"}},[s("t-input",{class:{"hover-active":t.isSearchFocus},attrs:{placeholder:"请输入搜索内容"},on:{blur:function(e){return t.changeSearchFocus(!1)},focus:function(e){return t.changeSearchFocus(!0)},input:t.filterData},scopedSlots:t._u([{key:"prefix-icon",fn:function(){return[s("search-icon",{staticClass:"icon",attrs:{size:"16"}})]},proxy:!0}]),model:{value:t.searchData,callback:function(e){t.searchData=e},expression:"searchData"}}),[s("t-space",[s("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPPathScan}},[t._v("对选定的项目启动 HTTP路径 扫描")]),s("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPSPathScan}},[t._v("对选定的项目启动 HTTPS路径 扫描")]),s("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPPathSimpleScan}},[t._v("对选定的项目启动 简单HTTP路径 扫描")]),s("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPPathSimpleScan}},[t._v("对选定的项目启动 简单HTTPS路径 扫描")]),s("t-button",{attrs:{theme:"primary"},on:{click:t.exportToCSV}},[t._v("导出CSV")])],1)],s("t-table",{attrs:{rowKey:"id",data:t.data,columns:t.columns,stripe:t.stripe,bordered:t.bordered,hover:t.hover,size:t.size,"table-layout":t.tableLayout?"auto":"fixed",pagination:t.pagination,showHeader:t.showHeader,"selected-row-keys":t.selectedRowKeys,cellEmptyContent:"-",resizable:""},on:{"select-change":t.rehandleSelectChange,"page-change":t.onPageChange}})],2)},y=[];const c={};var f=d(_,m,y,!1,S,null,null,null);function S(t){for(let a in c)this[a]=c[a]}const w=function(){return f.exports}();export{w as default};
