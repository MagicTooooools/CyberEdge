import{c as i,n as l}from"./index-6878f845.js";const d={data(){return this.$createElement,{data:[],size:"medium",tableLayout:!1,stripe:!0,bordered:!0,hover:!1,showHeader:!0,selectedRowKeys:[1],columns:[{colKey:"row-select",type:"multiple",width:50},{colKey:"id",title:"#",width:"50",ellipsis:!0},{colKey:"subdomain",title:"子域名",width:"200",ellipsis:!0},{colKey:"ip_address",title:"IP 地址",width:"150",ellipsis:!0},{colKey:"status",title:"状态码",width:"100"},{colKey:"cname",title:"CNAME",width:"200",ellipsis:!0},{colKey:"port",title:"端口",width:"100"},{colKey:"title",title:"标题",width:"200",ellipsis:!0},{colKey:"banner",title:"横幅",width:"200",ellipsis:!0},{colKey:"asn",title:"ASN",width:"150",ellipsis:!0},{colKey:"org",title:"组织",width:"200",ellipsis:!0},{colKey:"addr",title:"地址",width:"200",ellipsis:!0},{colKey:"isp",title:"ISP",width:"150",ellipsis:!0},{colKey:"source",title:"来源",width:"150",ellipsis:!0},{colKey:"operation",title:"操作",width:120,cell:(e,{row:n})=>e("t-button",{attrs:{theme:"danger",ghost:!0},on:{click:()=>this.deleteResult(n.id)}},["删除"])}],pagination:{current:1,pageSize:50,total:0,showJumper:!0}}},methods:{fetchResults(e){const n={task_id:e};this.$request.post("/api/subdomain_scanner/task_status",JSON.stringify(n),{headers:{"Content-Type":"application/json"}}).then(t=>{const s=t.data.task_result.subdomains,o=s.length;o>0?(i.success(`子域名扫描结果已获取，共${o}条数据。`),this.data=s,this.pagination.total=o):i.info("没有获取到子域名扫描结果。")}).catch(t=>{console.log(t),i.error("获取失败")})},deleteResult(e){this.$request.delete(`/api/subdomain_scanner/subdomains/${e}/delete`,{headers:{"Content-Type":"application/json"}}).then(()=>{i.success("结果删除成功"),this.data=this.data.filter(n=>n.id!==e),this.pagination.total=this.data.length}).catch(n=>{console.error(n),i.error("删除失败")})},rehandleSelectChange(e,{selectedRowData:n}){this.selectedRowKeys=e},startFullPortScan(){const e=this.selectedRowKeys.map(s=>this.data.find(o=>o.id===s)).filter(s=>s&&s.ip_address).map(s=>s.ip_address),t={target:[...new Set(e)].join(",")};this.$request.post("/api/port_scanner/scan",t,{headers:{"Content-Type":"application/json"}}).then(()=>{i.success("端口扫描任务已启动")}).catch(s=>{console.error(s),i.error("启动端口扫描任务失败")})},startCommonPortScan(){const e=this.selectedRowKeys.map(o=>this.data.find(a=>a.id===o)).filter(o=>o&&o.ip_address).map(o=>o.ip_address),n=[...new Set(e)],t="20,21,22,23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080",s={target:n.join(","),ports:t};this.$request.post("/api/port_scanner/scan",s,{headers:{"Content-Type":"application/json"}}).then(()=>{i.success("常见端口扫描任务已启动")}).catch(o=>{console.error(o),i.error("启动常见端口扫描任务失败")})},startLowPortScan(){const e=this.selectedRowKeys.map(s=>this.data.find(o=>o.id===s)).filter(s=>s&&s.ip_address).map(s=>s.ip_address),t={target:[...new Set(e)].join(","),ports:"1-10000"};this.$request.post("/api/port_scanner/scan",t,{headers:{"Content-Type":"application/json"}}).then(()=>{this.$message.success("低端口扫描任务已启动")}).catch(s=>{console.error(s),this.$message.error("启动低端口扫描任务失败")})},exportToCSV(){const e=[],n=["ID","子域名","IP 地址","状态码","CNAME","端口","标题","横幅","ASN","组织","地址","ISP","来源"];e.push(n.join(",")),this.data.forEach(a=>{const c=[a.id,`"${a.subdomain}"`,a.ip_address,a.status,`"${a.cname}"`,a.port,`"${a.title}"`,`"${a.banner}"`,a.asn,`"${a.org}"`,`"${a.addr}"`,a.isp,a.source];e.push(c.join(","))});const t=e.join(`
`),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download="subdomain-scan-results.csv",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)},exportUniqueSubdomains(){const e=Array.from(new Set(this.data.map(s=>s.subdomain))).sort(),n=new Blob([e.join(`
`)],{type:"text/plain;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download="unique-subdomains.txt",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},exportUniqueIPs(){const e=Array.from(new Set(this.data.map(s=>s.ip_address))).sort(),n=new Blob([e.join(`
`)],{type:"text/plain;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download="unique-ips.txt",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},onPageChange(e,n){this.pagination.defaultCurrent||(this.pagination.current=e.current,this.pagination.pageSize=e.pageSize)}},mounted(){const e=this.$route.query.task_id;this.fetchResults(e)}};var u=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("t-space",{attrs:{direction:"vertical"}},[[t("t-space",[t("t-button",{attrs:{theme:"primary"},on:{click:e.startFullPortScan}},[e._v("对选中的项目启动 全端口 扫描")]),t("t-button",{attrs:{theme:"primary"},on:{click:e.startCommonPortScan}},[e._v("对选中的项目启动 常用端口 扫描")]),t("t-button",{attrs:{theme:"primary"},on:{click:e.startLowPortScan}},[e._v("对选中的项目启动 低端口(1-10000) 扫描")]),t("t-button",{attrs:{theme:"primary"},on:{click:e.exportToCSV}},[e._v("导出CSV")]),t("t-button",{attrs:{theme:"primary"},on:{click:e.exportUniqueSubdomains}},[e._v("导出子域名TXT")]),t("t-button",{attrs:{theme:"primary"},on:{click:e.exportUniqueIPs}},[e._v("导出IP地址TXT")])],1)],t("t-table",{attrs:{rowKey:"id",data:e.data,columns:e.columns,stripe:e.stripe,bordered:e.bordered,hover:e.hover,size:e.size,"table-layout":e.tableLayout?"auto":"fixed",pagination:e.pagination,showHeader:e.showHeader,"selected-row-keys":e.selectedRowKeys,cellEmptyContent:"-",resizable:""},on:{"select-change":e.rehandleSelectChange,"page-change":e.onPageChange}})],2)},p=[];const r={};var h=l(d,u,p,!1,m,null,null,null);function m(e){for(let n in r)this[n]=r[n]}const b=function(){return h.exports}();export{b as default};
