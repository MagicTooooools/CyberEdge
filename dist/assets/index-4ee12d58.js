import{C as i}from"./close-circle-filled-78d9f7c3.js";import{C as u,E as d}from"./error-circle-filled-d47225f7.js";import{c as l,n as h}from"./index-44f9d56c.js";const p={data(){return this.$createElement,{data:[],size:"medium",tableLayout:!1,stripe:!0,bordered:!0,hover:!1,showHeader:!0,selectedRowKeys:[1],columns:[{colKey:"id",title:"#",width:"50",ellipsis:!0},{colKey:"url",title:"URL",width:"300",ellipsis:!0},{colKey:"content_type",title:"内容类型",width:"200",ellipsis:!0},{colKey:"status",title:"状态码",width:"100",cell:(e,{row:t})=>{let s={label:`HTTP (${t.status})`,theme:"default",icon:e(i)};return t.status>=200&&t.status<300?s={label:`HTTP (${t.status})`,theme:"success",icon:e(u)}:t.status>=300&&t.status<500?s={label:`HTTP (${t.status})`,theme:"warning",icon:e(d)}:t.status>=500&&(s={label:`HTTP (${t.status})`,theme:"danger",icon:e(i)}),e("t-tag",{attrs:{shape:"round",theme:s.theme,variant:"light-outline"}},[s.icon,s.label])}},{colKey:"length",title:"响应长度",width:"150"},{colKey:"operation",title:"操作",width:120,cell:(e,{row:t})=>e("t-button",{attrs:{theme:"danger",ghost:!0},on:{click:()=>this.deleteResult(t.id)}},["删除"])}],pagination:{current:1,pageSize:5,total:0,showJumper:!0}}},methods:{fetchResults(e){const t={task_id:e};this.$request.post("/api/path_scanner/task_status",JSON.stringify(t),{headers:{"Content-Type":"application/json"}}).then(s=>{const o=s.data.task_result.results,a=o.length;a>0?(l.success(`路径扫描结果已获取，共${a}条数据。`),this.data=o,this.pagination.total=a):l.info("没有获取到路径扫描结果。")}).catch(s=>{console.log(s),l.error("获取失败")})},deleteResult(e){this.$request.delete(`/api/path_scanner/paths/${e}/delete`,{headers:{"Content-Type":"application/json"}}).then(()=>{l.success("结果删除成功"),this.data=this.data.filter(t=>t.id!==e),this.pagination.total=this.data.length}).catch(t=>{console.error(t),l.error("删除失败")})},rehandleSelectChange(e,{selectedRowData:t}){this.selectedRowKeys=e},onPageChange(e,t){this.pagination.defaultCurrent||(this.pagination.current=e.current,this.pagination.pageSize=e.pageSize)},exportToCSV(){const e=[],t=["ID","URL","内容类型","状态码","响应长度"];e.push(t.join(",")),this.data.forEach(n=>{const c=[n.id,`"${n.url}"`,n.content_type,n.status,n.length];e.push(c.join(","))});const s=e.join(`
`),o=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="path-scan-results.csv",a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}},mounted(){const e=this.$route.query.task_id;this.fetchResults(e)}};var g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-space",{attrs:{direction:"vertical"}},[s("t-button",{attrs:{theme:"primary"},on:{click:e.exportToCSV}},[e._v("导出CSV")]),s("t-table",{attrs:{rowKey:"id",data:e.data,columns:e.columns,stripe:e.stripe,bordered:e.bordered,hover:e.hover,size:e.size,"table-layout":e.tableLayout?"auto":"fixed",pagination:e.pagination,showHeader:e.showHeader,"selected-row-keys":e.selectedRowKeys,cellEmptyContent:"-",resizable:""},on:{"select-change":e.rehandleSelectChange,"page-change":e.onPageChange}})],1)},_=[];const r={};var m=h(p,g,_,!1,y,null,null,null);function y(e){for(let t in r)this[t]=r[t]}const b=function(){return m.exports}();export{b as default};
