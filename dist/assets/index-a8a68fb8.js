import{C as i,E as l}from"./error-circle-filled-d47225f7.js";import{c as o,n as d}from"./index-44f9d56c.js";const p={data(){return this.$createElement,{data:[],size:"medium",tableLayout:!1,stripe:!0,bordered:!0,hover:!1,showHeader:!0,selectedRowKeys:[1],columns:[{colKey:"row-select",type:"multiple",width:50},{colKey:"id",title:"#",width:"50",ellipsis:!0},{colKey:"ip_address",title:"IP 地址",width:"150",ellipsis:!0},{colKey:"port_number",title:"端口号",width:"100"},{colKey:"service_name",title:"服务名称",width:"200",ellipsis:!0},{colKey:"protocol",title:"协议",width:"100"},{colKey:"state",title:"状态",width:"150",cell:(t,{row:s})=>{const e={open:{label:"开放",theme:"success",icon:t(i)},closed:{label:"关闭",theme:"danger",icon:t(l)}}[s.state.toLowerCase()]||{label:s.state,theme:"default"};return t("t-tag",{attrs:{shape:"round",theme:e.theme,variant:"light-outline"}},[e.icon,e.label])}},{colKey:"is_http",title:"是否支持HTTP",width:"100",cell:(t,{row:s})=>{const e={true:{label:"支持",theme:"success",icon:t(i)},false:{label:"不支持",theme:"danger",icon:t(l)}}[s.is_http]||{label:"未知",theme:"default"};return t("t-tag",{attrs:{shape:"round",theme:e.theme,variant:"light-outline"}},[e.icon,e.label])}},{colKey:"is_https",title:"是否支持HTTPS",width:"100",cell:(t,{row:s})=>{const e={true:{label:"支持",theme:"success",icon:t(i)},false:{label:"不支持",theme:"danger",icon:t(l)}}[s.is_https]||{label:"未知",theme:"default"};return t("t-tag",{attrs:{shape:"round",theme:e.theme,variant:"light-outline"}},[e.icon,e.label])}},{colKey:"operation",title:"操作",width:120,cell:(t,{row:s})=>t("t-button",{attrs:{theme:"danger",ghost:!0},on:{click:()=>this.deleteResult(s.id)}},["删除"])}],pagination:{current:1,pageSize:5,total:0,showJumper:!0}}},methods:{fetchResults(t){const s={task_id:t};this.$request.post("/api/port_scanner/task_status",JSON.stringify(s),{headers:{"Content-Type":"application/json"}}).then(a=>{const e=a.data.task_result.ports,n=e.length;n>0?(o.success(`端口扫描结果已获取，共${n}条数据。`),this.data=e,this.pagination.total=n):o.info("没有获取到端口扫描结果。")}).catch(a=>{console.log(a),o.error("获取失败")})},deleteResult(t){this.$request.delete(`/api/port_scanner/ports/${t}/delete`,{headers:{"Content-Type":"application/json"}}).then(()=>{o.success("结果删除成功"),this.data=this.data.filter(s=>s.id!==t),this.pagination.total=this.data.length}).catch(s=>{console.error(s),o.error("删除失败")})},rehandleSelectChange(t,{selectedRowData:s}){this.selectedRowKeys=t},startHTTPPathScan(){const t=this.selectedRowKeys.map(e=>this.data.find(n=>n.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`http://${e.ip_address}:${e.port_number}/FUZZ`),a={urls:[...new Set(t)]};this.$request.post("/api/path_scanner/scan",a,{headers:{"Content-Type":"application/json"}}).then(()=>{o.success("路径扫描任务已启动")}).catch(e=>{console.error(e),o.error("启动路径扫描任务失败")})},startHTTPSPathScan(){const t=this.selectedRowKeys.map(e=>this.data.find(n=>n.id===e)).filter(e=>e&&e.ip_address&&e.port_number).map(e=>`https://${e.ip_address}:${e.port_number}/FUZZ`),a={urls:[...new Set(t)]};this.$request.post("/api/path_scanner/scan",a,{headers:{"Content-Type":"application/json"}}).then(()=>{o.success("路径扫描任务已启动")}).catch(e=>{console.error(e),o.error("启动路径扫描任务失败")})},onPageChange(t,s){this.pagination.defaultCurrent||(this.pagination.current=t.current,this.pagination.pageSize=t.pageSize)},exportToCSV(){const t=[],s=["ID","IP 地址","端口号","服务名称","协议","状态","是否支持HTTP","是否支持HTTPS"];t.push(s.join(",")),this.data.forEach(r=>{const h=[r.id,`"${r.ip_address}"`,r.port_number,`"${r.service_name}"`,r.protocol,r.state,r.is_http?"支持":"不支持",r.is_https?"支持":"不支持"];t.push(h.join(","))});const a=t.join(`
`),e=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download="port-scan-results.csv",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},mounted(){const t=this.$route.query.task_id;this.fetchResults(t)}};var u=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("t-space",{attrs:{direction:"vertical"}},[[a("t-space",[a("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPPathScan}},[t._v("对选定的项目启动 HTTP路径 扫描")]),a("t-button",{attrs:{theme:"primary"},on:{click:t.startHTTPSPathScan}},[t._v("对选定的项目启动 HTTPS路径 扫描")]),a("t-button",{attrs:{theme:"primary"},on:{click:t.exportToCSV}},[t._v("导出CSV")])],1)],a("t-table",{attrs:{rowKey:"id",data:t.data,columns:t.columns,stripe:t.stripe,bordered:t.bordered,hover:t.hover,size:t.size,"table-layout":t.tableLayout?"auto":"fixed",pagination:t.pagination,showHeader:t.showHeader,"selected-row-keys":t.selectedRowKeys,cellEmptyContent:"-",resizable:""},on:{"select-change":t.rehandleSelectChange,"page-change":t.onPageChange}})],2)},_=[];const c={};var m=d(p,u,_,!1,y,null,null,null);function y(t){for(let s in c)this[s]=c[s]}const f=function(){return m.exports}();export{f as default};
